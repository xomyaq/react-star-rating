"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),_get=function(t,e,a){for(var n=!0;n;){var i=t,r=e,s=a;n=!1,null===i&&(i=Function.prototype);var o=Object.getOwnPropertyDescriptor(i,r);if(void 0!==o){if("value"in o)return o.value;var l=o.get;if(void 0===l)return;return l.call(s)}var u=Object.getPrototypeOf(i);if(null===u)return;t=u,e=r,a=s,n=!0,o=u=void 0}},_react=require("react"),_react2=_interopRequireDefault(_react),_classnames=require("classnames"),_classnames2=_interopRequireDefault(_classnames),StarRating=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={ratingCache:{pos:0,rating:0},editing:t.editing||!0,stars:5,rating:0,pos:0,glyph:this.getStars()}}return _inherits(e,t),_createClass(e,[{key:"getStars",value:function(){for(var t="",e=this.props.ratingAmount,a=0;e>a;a++)t+="â˜…";return t}},{key:"componentWillMount",value:function(){if(this.min=0,this.max=this.props.ratingAmount||5,this.props.rating){this.state.editing=this.props.editing||!1;var t=this.props.rating;this.state.ratingCache.pos=this.getStarRatingPosition(t),this.setState({ratingCache:this.state.ratingCache,rating:t,pos:this.getStarRatingPosition(t)})}}},{key:"componentDidMount",value:function(){this.root=this.refs.root,this.ratingContainer=this.refs.ratingContainer}},{key:"componentWillUnmount",value:function(){delete this.root,delete this.ratingContainer}},{key:"getPosition",value:function(t){return t.pageX-this.root.getBoundingClientRect().left}},{key:"applyPrecision",value:function(t,e){return parseFloat(t.toFixed(e))}},{key:"getDecimalPlaces",value:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}},{key:"getWidthFromValue",value:function(t){var e=this.min,a=this.max;return e>=t||e===a?0:t>=a?100:100*(t-e)/(a-e)}},{key:"getValueFromPosition",value:function(t){var e=this.getDecimalPlaces(this.props.step),a=this.ratingContainer.offsetWidth,n=this.max-this.min,i=n*t/(a*this.props.step);i=Math.ceil(i);var r=this.applyPrecision(parseFloat(this.min+i*this.props.step),e);return r=Math.max(Math.min(r,this.max),this.min)}},{key:"calculate",value:function(t){var e=this.getValueFromPosition(t),a=this.getWidthFromValue(e);return a+="%",{width:a,val:e}}},{key:"getStarRatingPosition",value:function(t){var e=this.getWidthFromValue(t)+"%";return e}},{key:"getRatingEvent",value:function(t){var e=this.getPosition(t);return this.calculate(e)}},{key:"getSvg",value:function(){return _react2["default"].createElement("svg",{className:"react-star-rating__star",viewBox:"0 0 286 272",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},_react2["default"].createElement("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},_react2["default"].createElement("polygon",{id:"star-flat",points:"143 225 54.8322122 271.352549 71.6707613 173.176275 0.341522556 103.647451 98.9161061 89.3237254 143 0 187.083894 89.3237254 285.658477 103.647451 214.329239 173.176275 231.167788 271.352549 "})))}},{key:"handleMouseLeave",value:function(){this.setState({pos:this.state.ratingCache.pos,rating:this.state.ratingCache.rating})}},{key:"handleMouseMove",value:function(t){var e=this.getRatingEvent(t);this.updateRating(e.width,e.val)}},{key:"updateRating",value:function(t,e){this.setState({pos:t,rating:e})}},{key:"shouldComponentUpdate",value:function(t,e){return t!==this.props?(this.updateRating(this.getStarRatingPosition(t.rating),t.rating),!0):e.ratingCache.rating!==this.state.ratingCache.rating||e.rating!==this.state.rating}},{key:"handleClick",value:function(t){if(this.props.disabled)return t.stopPropagation(),t.preventDefault(),!1;var e={pos:this.state.pos,rating:this.state.rating,caption:this.props.caption,name:this.props.name};this.setState({ratingCache:e}),this.props.onRatingClick(t,e)}},{key:"treatName",value:function(t){return"string"==typeof t?t.toLowerCase().split(" ").join("_"):void 0}},{key:"renderInput",value:function(){return _react2["default"].createElement("input",{readOnly:!0,type:"number",name:this.props.name,value:this.state.ratingCache.rating,style:{display:"none"},min:this.min,max:this.max})}},{key:"renderEditing",value:function(){var t=this;return _react2["default"].createElement("div",{ref:function(e){return t.ratingContainer=e},className:"rating-container rating-gly-star","data-content":this.state.glyph,onMouseMove:this.handleMouseMove.bind(this),onMouseLeave:this.handleMouseLeave.bind(this),onClick:this.handleClick.bind(this)},_react2["default"].createElement("div",{className:"rating-stars","data-content":this.state.glyph,style:{width:this.state.pos}}),this.renderInput())}},{key:"renderShow",value:function(){return _react2["default"].createElement("div",{ref:"ratingContainer",className:"rating-container rating-gly-star","data-content":this.state.glyph},_react2["default"].createElement("div",{className:"rating-stars","data-content":this.state.glyph,style:{width:this.state.pos}}),this.renderInput())}},{key:"render",value:function(){var t,e=this,a=(0,_classnames2["default"])((t={"react-star-rating__root":!0,"rating-disabled":this.props.disabled},_defineProperty(t,"react-star-rating__size--"+this.props.size,this.props.size),_defineProperty(t,"rating-editing",this.state.editing),t));return _react2["default"].createElement("span",{className:"react-star-rating"},this.props.caption&&!!this.props.caption.length&&_react2["default"].createElement("span",{className:"react-rating-caption"},this.props.caption),_react2["default"].createElement("span",{ref:function(t){return e.root=t},style:{cursor:"pointer"},className:a},this.state.editing?this.renderEditing():this.renderShow()))}}]),e}(_react2["default"].Component);StarRating.propTypes={name:_react2["default"].PropTypes.string.isRequired,caption:_react2["default"].PropTypes.string,ratingAmount:_react2["default"].PropTypes.number.isRequired,rating:_react2["default"].PropTypes.number,onRatingClick:_react2["default"].PropTypes.func,disabled:_react2["default"].PropTypes.bool,editing:_react2["default"].PropTypes.bool,size:_react2["default"].PropTypes.string},StarRating.defaultProps={step:.5,ratingAmount:5,onRatingClick:function(){},disabled:!1},exports["default"]=StarRating,module.exports=exports["default"];